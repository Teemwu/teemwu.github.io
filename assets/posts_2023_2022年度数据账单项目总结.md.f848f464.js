import{_ as c,c as r,C as n,z as y,x as l,a as i,N as D,D as p,o as F}from"./chunks/framework.af95065a.js";const _=JSON.parse('{"title":"2022年度数据账单项目总结","description":"","frontmatter":{"title":"2022年度数据账单项目总结","author":"teemwu","date":"2023/01/06 17:46","isPublished":true,"categories":["实战"],"tags":["总结","年度账单"],"wordCount":1797},"headers":[{"level":1,"title":"2022年度数据账单项目总结","slug":"_2022年度数据账单项目总结","link":"#_2022年度数据账单项目总结","children":[{"level":2,"title":"交互框架搭建","slug":"交互框架搭建","link":"#交互框架搭建","children":[]},{"level":2,"title":"动画实现","slug":"动画实现","link":"#动画实现","children":[{"level":3,"title":"Animate.css 使用","slug":"animate-css-使用","link":"#animate-css-使用","children":[]},{"level":3,"title":"替换掉 Anime.js","slug":"替换掉-anime-js","link":"#替换掉-anime-js","children":[]}]},{"level":2,"title":"一些优化","slug":"一些优化","link":"#一些优化","children":[{"level":3,"title":"可视化查看代码体积","slug":"可视化查看代码体积","link":"#可视化查看代码体积","children":[]},{"level":3,"title":"移除 vue-router","slug":"移除-vue-router","link":"#移除-vue-router","children":[]},{"level":3,"title":"去除 animate.css 多余类","slug":"去除-animate-css-多余类","link":"#去除-animate-css-多余类","children":[]}]},{"level":2,"title":"遇到的问题","slug":"遇到的问题","link":"#遇到的问题","children":[{"level":3,"title":"1. 分享出去是链接，不是卡片","slug":"_1-分享出去是链接-不是卡片","link":"#_1-分享出去是链接-不是卡片","children":[]},{"level":3,"title":"2. 如何真机调试","slug":"_2-如何真机调试","link":"#_2-如何真机调试","children":[]},{"level":3,"title":"3. 上线前图片存到 OSS","slug":"_3-上线前图片存到-oss","link":"#_3-上线前图片存到-oss","children":[]},{"level":3,"title":"4. 打包后样式不一致","slug":"_4-打包后样式不一致","link":"#_4-打包后样式不一致","children":[]}]}]}],"relativePath":"posts/2023/2022年度数据账单项目总结.md","lastUpdated":1679880402000}'),C={name:"posts/2023/2022年度数据账单项目总结.md"},A=l("h1",{id:"_2022年度数据账单项目总结",tabindex:"-1"},[i("2022年度数据账单项目总结 "),l("a",{class:"header-anchor",href:"#_2022年度数据账单项目总结","aria-label":'Permalink to "2022年度数据账单项目总结"'},"​")],-1),d=D(`<p>有两三年没做过年度账单 H5 项目了，接到需求，要在 2022 年末上线，当即火急火燎进行技术调研。看了往年的年度账单，就是一张背景图加上文字渐入效果，相当简单。2022 年时间上还充裕，花了一周时间去了解平时不怎么用的 GSAP 和 animeJS，参考了网易云音乐的年度账单效果，发现需要用 AE 来进行场景的设计，可是自己和 UI 设计师也不熟悉 AE，无奈最后决定使用简单的方法来实现。</p><h2 id="交互框架搭建" tabindex="-1">交互框架搭建 <a class="header-anchor" href="#交互框架搭建" aria-label="Permalink to &quot;交互框架搭建&quot;">​</a></h2><p>根据研发讨论，我们的交互应该是整屏的内容切换，切换方式就是上下滑动或者左右滑动，页面进场、离场或者用户操作的过程中页面中的元素应该有对应的动画效果。基于这些想法，想起了很久没用的 <code>fullPage.js</code>，貌似这个满足当前的需求，然而查看证书发现要收费才能使用了，由于平常使用场景比较少就不考虑付费使用，只能另找其它开源库。后来想了下，经常用的 <code>swiperJs</code> 不是也可以满足需求么，滑动就是这个库的强项，而且还开源，所以就选它了。</p><p>项目使用了 Vue3.x 版本，而 SwiperJS 也默认支持了 Vue3，所以使用时直接安装引入即可。</p><p><strong>安装 swiper：</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">swiper</span></span>
<span class="line"></span></code></pre></div><p><strong>使用</strong></p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-D8_UR" id="tab-s__mc41" checked="checked"><label for="tab-s__mc41">template</label><input type="radio" name="group-D8_UR" id="tab-073HoNI"><label for="tab-073HoNI">script</label><input type="radio" name="group-D8_UR" id="tab-zy7tqZ_"><label for="tab-zy7tqZ_">style</label></div><div class="blocks"><div class="language-vue active"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">swiper</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ref</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">swiperRef</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">effect</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&#39;</span><span style="color:#C3E88D;">fade</span><span style="color:#89DDFF;">&#39;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">observer</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">slides-per-view</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">spaceBetween</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">direction</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&#39;</span><span style="color:#C3E88D;">vertical</span><span style="color:#89DDFF;">&#39;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">parallax</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">modules</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">init</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">onInit</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">transition-end</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">onTransitionEnd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;swiper-slide class=&quot;slide-1&quot;&gt;&lt;/swiper-slide&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;swiper-slide class=&quot;slide-2&quot;&gt;&lt;/swiper-slide&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;swiper-slide class=&quot;slide-3&quot;&gt;&lt;/swiper-slide&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">swiper</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">watch</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ref</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inject</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Swiper</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SwiperSlide</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">swiper/vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Swiper</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SwiperType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">swiper</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parallax</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">EffectFade</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">swiper</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">swiper/css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">swiper/css/effect-fade</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> swiperInstance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> modules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [Parallax</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> EffectFade]</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> current </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 滑块初始化</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">swiper</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> onInit </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">swiper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SwiperType</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">swiperInstance</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">swiper</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">swiper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slideTo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">current</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 记录滑块索引</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">swiper</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> onTransitionEnd </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">swiper</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SwiperType</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (current</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> swiper</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeIndex)</span></span>
<span class="line"></span></code></pre></div><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">swiper</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">swiper-slide</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">font-size</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">18px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">display</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> flex</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">flex-direction</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> column</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">justify-content</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> flex-start</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">align-items</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> center</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">swiper-slide-content</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100%</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><h2 id="动画实现" tabindex="-1">动画实现 <a class="header-anchor" href="#动画实现" aria-label="Permalink to &quot;动画实现&quot;">​</a></h2><p>要实现动画效果有很多选择，为了缩小项目体积，摒弃了 <code>anime.js</code> 和 <code>GSAP</code> 等相关动画库，选择单纯使用 CSS3 的 animation 来实现动画效果。动画库的话就使用 <code>animate.css</code>，再加上 <code>SwiperJS</code> 自带的视觉差效果和渐入渐出转场，也基本满足需求了。</p><h3 id="animate-css-使用" tabindex="-1">Animate.css 使用 <a class="header-anchor" href="#animate-css-使用" aria-label="Permalink to &quot;Animate.css 使用&quot;">​</a></h3><p><code>SwiperJS</code> 中直接使用 <code>animate.css</code> 会存在一个问题，就是不会重复执行动画。要解决这个问题其实只需要让动画元素重新渲染即可，要重新渲染最直接的方法是通过 <code>v-if</code> 来控制 <code>swiper-slide</code> 的显示隐藏。如果通过监测 <code>slide-change</code> 事件来改变当前滑块的索引，这样做会出现滑块转场动画执行不完全的状态（比如 fade 转场透明度没执行完），解决这个问题直接通过监测 <code>transition-end</code> 事件进行当前滑块索引更新即可。</p><h3 id="替换掉-anime-js" tabindex="-1">替换掉 Anime.js <a class="header-anchor" href="#替换掉-anime-js" aria-label="Permalink to &quot;替换掉 Anime.js&quot;">​</a></h3><p>前期考虑到如果时间充足的话可以使用 <code>anime.js</code> 来细化一些动画的执行，不过后来项目写到尾声才发现，时间不够充裕。前期用到 <code>anime.js</code> 的地方主要是图片资源加载百分比数字动画和文字逐行渐进动画，而在使用的过程中发现 <code>anime.js</code> 本身存在一些问题，加上考虑文件体积，故使用其它方法将其换掉。</p><p><strong>百分比数字动画</strong></p><p>如果直接修改百分比数字到话，因为网络延迟方面的原因，百分比可能会一下子由一个很小的数字直接变到很大的数字，这样用户看着就会觉得很突兀。</p><p>通过 <code>setTimeout</code> 实现</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ref</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> progressRef </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 更新进度条百分比</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> temp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> timer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> updateProgress </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">num</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clearTimeout</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">temp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">num</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">temp</span><span style="color:#89DDFF;">++</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">progressRef</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">temp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">updateProgress</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">num</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">16</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>由于浏览器显示频率的问题，通过 <code>setTimeout</code> 来进行刷新百分比可能出现丢帧现象，我们可以通过 <code>requestAnimation</code> 来优化，具体可以看我的<a href="./用 requestAnimationFrame 来实现 setTimeout、setInterval">另一篇文章</a>。</p><h2 id="一些优化" tabindex="-1">一些优化 <a class="header-anchor" href="#一些优化" aria-label="Permalink to &quot;一些优化&quot;">​</a></h2><p>优化主要围绕代码体积、页面加载、渲染效率等方面进行。</p><h3 id="可视化查看代码体积" tabindex="-1">可视化查看代码体积 <a class="header-anchor" href="#可视化查看代码体积" aria-label="Permalink to &quot;可视化查看代码体积&quot;">​</a></h3><p>要减少代码体积，我们首先要知道哪些地方代码体积太大了。可视化分析代码体积的库很多，vite 中可使用 <code>rollup-plugin-visualizer</code> 。</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rollup-plugin-visualizer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span>
<span class="line"></span></code></pre></div><p>安装完后，需要在 <code>vite.config.ts</code> 打包配置中引入。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> vue </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">visualizer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-visualizer</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">[</span><span style="color:#82AAFF;">vue</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">visualizer</span><span style="color:#F07178;">()]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>然后执行构建</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span></code></pre></div><p>构建后在项目根目录会生成一个 <code>stats.html</code> 的文件，直接浏览器打开就可以看到各个代码占的体积。</p><p>当然，没必要将分析文件上传到远程代码仓库，可在 <code>.gitignore</code> 中增加排除。</p><h3 id="移除-vue-router" tabindex="-1">移除 <code>vue-router</code> <a class="header-anchor" href="#移除-vue-router" aria-label="Permalink to &quot;移除 \`vue-router\`&quot;">​</a></h3><p>经过代码可视化分析，发现项目模板中引入了路由，但由于年度账单无需多页面跳转，没必要引入 <code>vue-router</code> ，移除后能减少几十 K 的代码体积。</p><h3 id="去除-animate-css-多余类" tabindex="-1">去除 <code>animate.css</code> 多余类 <a class="header-anchor" href="#去除-animate-css-多余类" aria-label="Permalink to &quot;去除 \`animate.css\` 多余类&quot;">​</a></h3><p>项目中使用到的动画有限，没必要引入 <code>animate.css</code> 所有的动画文件。</p><p>要按需引入我们需要将 <code>animate.css</code> 的代码仓库拉取下来，在本地修改 <code>animate.css/source/animate.css</code> 中的引入文件，然后执行重新构建。</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"></span></code></pre></div><p>在需要使用的地方引入新构建的 <code>animate.css/animate.min.css</code> 文件就行。</p><h2 id="遇到的问题" tabindex="-1">遇到的问题 <a class="header-anchor" href="#遇到的问题" aria-label="Permalink to &quot;遇到的问题&quot;">​</a></h2><h3 id="_1-分享出去是链接-不是卡片" tabindex="-1">1. 分享出去是链接，不是卡片 <a class="header-anchor" href="#_1-分享出去是链接-不是卡片" aria-label="Permalink to &quot;1. 分享出去是链接，不是卡片&quot;">​</a></h3><p>微信开放全域名访问后出现的限制。目前可从 <code>公众号菜单进入分享</code>、<code>扫描二维码后分享</code>、<code>添加到收藏然后从微信我的收藏进入分享</code> 是正常的，其他地方进入分享都是链接。</p><h3 id="_2-如何真机调试" tabindex="-1">2. 如何真机调试 <a class="header-anchor" href="#_2-如何真机调试" aria-label="Permalink to &quot;2. 如何真机调试&quot;">​</a></h3><p>由于一些效果在浏览器上复现不了，需要真机上调试。真机调试一般有两种方法，一种是安装 <a href="https://github.com/wuchangming/spy-debugger" target="_blank" rel="noreferrer">spy-debugger</a> ，另一种是使用 Chrome 浏览器自带的远程调试 <code>chrome://inspect</code> 。 两者各有利弊，前者需要安装证书，后者需要通过 USB 连接调试。具体可参考我的<a href="./H5页面真机调试方法整理">另一篇文章</a>。</p><h3 id="_3-上线前图片存到-oss" tabindex="-1">3. 上线前图片存到 OSS <a class="header-anchor" href="#_3-上线前图片存到-oss" aria-label="Permalink to &quot;3. 上线前图片存到 OSS&quot;">​</a></h3><p>图片务必存储到 OSS，不然普通服务器带宽承受不住，一上线访问数一多服务器就会奔溃。</p><h3 id="_4-打包后样式不一致" tabindex="-1">4. 打包后样式不一致 <a class="header-anchor" href="#_4-打包后样式不一致" aria-label="Permalink to &quot;4. 打包后样式不一致&quot;">​</a></h3><p>这主要是使用了 <code>autoprefixer</code> 自动加浏览器前缀造成。解决方案是使用规范的样式，比如使用 Photoshop 复制的渐变背景 CSS 是自动添加了浏览器前缀，此时解析的时候就会出现异常，需要手动删掉无用的浏览器前缀并只保留规范的写法。</p>`,46);function u(s,a,h,m,f,g){const o=p("articleMeta"),e=p("ClientOnly");return F(),r("div",null,[A,n(e,null,{default:y(()=>[n(o,{modelValue:s.$frontmatter,"onUpdate:modelValue":a[0]||(a[0]=t=>s.$frontmatter=t)},null,8,["modelValue"])]),_:1}),d])}const b=c(C,[["render",u]]);export{_ as __pageData,b as default};
