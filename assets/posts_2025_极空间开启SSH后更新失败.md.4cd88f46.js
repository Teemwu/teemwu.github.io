import{_ as c,G as a,o as r,c as C,L as o,w as y,k as l,a as D,U as A}from"./chunks/framework.6f6e9089.js";const f=JSON.parse('{"title":"极空间开启SSH后更新失败","description":"","frontmatter":{"title":"极空间开启SSH后更新失败","author":"teemwu","date":"2025/08/14 17:22","isPublished":true,"categories":null,"tags":null,"wordCount":515},"headers":[{"level":1,"title":"极空间开启SSH后更新失败","slug":"极空间开启ssh后更新失败","link":"#极空间开启ssh后更新失败","children":[]}],"relativePath":"posts/2025/极空间开启SSH后更新失败.md","filePath":"posts/2025/极空间开启SSH后更新失败.md","lastUpdated":1757476899000}'),F={name:"posts/2025/极空间开启SSH后更新失败.md"},i=l("h1",{id:"极空间开启ssh后更新失败",tabindex:"-1"},[D("极空间开启SSH后更新失败 "),l("a",{class:"header-anchor",href:"#极空间开启ssh后更新失败","aria-label":'Permalink to "极空间开启SSH后更新失败"'},"​")],-1),d=A(`<p>可能导致的原因是 root 权限改变，使用下面命令进行权限修复后，重启系统即可：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-euo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pipefail</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[1/6] 校准 root 账号与家目录</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># root 账号基本信息（若官方固件规定不同的 shell，请保留原值）</span></span>
<span class="line"><span style="color:#FFCB6B;">getent</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">passwd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 家目录与权限</span></span>
<span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/root</span></span>
<span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">700</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/root</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># SSH 密钥目录（如不存在则跳过）</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-d</span><span style="color:#A6ACCD;"> /root/.ssh </span><span style="color:#89DDFF;">];</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-R</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/root/.ssh</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">700</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/root/.ssh</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-f</span><span style="color:#A6ACCD;"> /root/.ssh/authorized_keys </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/root/.ssh/authorized_keys</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[2/6] 校准账号/组/口令相关文件</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">/etc/passwd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/group</span></span>
<span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">644</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">/etc/passwd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/group</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:shadow</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/shadow</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/gshadow</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">640</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">/etc/shadow</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/gshadow</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[3/6] 校准 sudo/su/passwd 这些必须的 setuid 工具</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 注意：有的固件可能没有 sudo（直接 root），无则忽略</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> f </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> /usr/bin/sudo /bin/su /usr/bin/passwd /usr/bin/chsh /usr/bin/chfn</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$f</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">continue</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$f</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4755</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$f</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># gpasswd/newgrp（有的系统是 setgid，按常见安全值处理）</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-e</span><span style="color:#A6ACCD;"> /usr/bin/gpasswd </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/bin/gpasswd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2755</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/bin/gpasswd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-e</span><span style="color:#A6ACCD;"> /usr/bin/newgrp </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/bin/newgrp</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2755</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/bin/newgrp</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[4/6] 校准 sudoers 与 sshd 配置权限</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-e</span><span style="color:#A6ACCD;"> /etc/sudoers </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sudoers</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">440</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sudoers</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-d</span><span style="color:#A6ACCD;"> /etc/sudoers.d </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-R</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sudoers.d</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">750</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sudoers.d</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">440</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sudoers.d/</span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-e</span><span style="color:#A6ACCD;"> /etc/ssh/sshd_config </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/ssh/sshd_config</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">644</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/ssh/sshd_config</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[5/6] 校验根目录与关键系统目录的基本权限（防止被误改过大）</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">755</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span></span>
<span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">755</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/sbin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/bin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/sbin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root:root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/sbin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/bin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/sbin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[6/6] 可选：用 dpkg 验证关键包的文件权限（仅 Debian/Ubuntu 有效）</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">command</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dpkg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;&amp;1;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">dpkg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-V</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">passwd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">dpkg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-V</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">dpkg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-V</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">login</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">dpkg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-V</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">openssh-server</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#C3E88D;">/dev/null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">完成。建议现在重启：reboot</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div>`,2);function u(s,n,E,h,B,m){const p=a("articleMeta"),e=a("ClientOnly");return r(),C("div",null,[i,o(e,null,{default:y(()=>[o(p,{modelValue:s.$frontmatter,"onUpdate:modelValue":n[0]||(n[0]=t=>s.$frontmatter=t)},null,8,["modelValue"])]),_:1}),d])}const g=c(F,[["render",u]]);export{f as __pageData,g as default};
